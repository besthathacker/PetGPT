<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>PetGPT Ultimate</title>
<script src="https://cdn.jsdelivr.net/npm/@xenova/transformers@2.6.0/dist/transformers.min.js"></script>
<style>
Â Â * { margin:0; padding:0; box-sizing:border-box; }
Â Â html, body { height:100%; font-family:Arial,sans-serif; background:#1e1e1e; color:white; display:flex; flex-direction:column; }
Â Â header, footer { background:#007acc; padding:16px; text-align:center; font-size:20px; flex-shrink:0; }
Â Â #chat { flex:1; overflow-y:auto; padding:10px; background:#2b2b2b; display:flex; flex-direction:column; }
Â Â .message { margin:6px 0; padding:8px; border-radius:6px; max-width:75%; word-wrap:break-word; }
Â Â .user { background:#3a3a3a; align-self:flex-end; }
Â Â .bot { background:#007acc; align-self:flex-start; }
Â Â #controls { display:flex; flex-wrap:wrap; gap:6px; padding:10px; background:#111; border-top:1px solid #444; flex-shrink:0; }
Â Â #userInput { flex:1 1 200px; min-width:120px; padding:8px; border:none; border-radius:4px; background:#333; color:#eee; }
Â Â button, input[type="file"] { padding:8px 12px; border:none; border-radius:4px; background:#007acc; color:white; cursor:pointer; flex-shrink:0; }
Â Â input[type="file"] { background:#444; }
Â Â .hex-preview { font-family:monospace; font-size:12px; background:#111; color:#0f0; padding:6px; border-radius:4px; overflow-x:auto; max-width:100%; }
Â Â @media(max-width:600px){ #controls{ flex-direction:column; } #userInput{ width:100%; } }
</style>
</head>
<body>

<header>ğŸ¾ PetGPT Ultimate</header>
<div id="chat"><div><strong>PetGPT:</strong> Hello! I'm ready to chat.</div></div>

<div id="controls">
Â Â <input id="userInput" placeholder="Type your message..." autocomplete="off" />
Â Â <button id="sendBtn">Send</button>
Â Â <button id="resetBtn">Reset Memory</button>
Â Â <button id="voiceBtn">ğŸ¤ Voice Chat</button>
Â Â <input type="file" id="fileUpload" title="Upload any file" />
</div>

<footer>Â© 2025 PetGPT</footer>

<script>
(async () => {
Â Â const chat = document.getElementById('chat');
Â Â const ui = document.getElementById('userInput');
Â Â const btSend = document.getElementById('sendBtn');
Â Â const btReset = document.getElementById('resetBtn');
Â Â const btVoice = document.getElementById('voiceBtn');
Â Â const fu = document.getElementById('fileUpload');

Â Â let memory = JSON.parse(localStorage.getItem('petgpt-memory') || '{}');
Â Â let tokenizer, model, gptReady = false;

Â Â const fallback = {
Â Â Â Â hello: "Hi there!",
Â Â Â Â bye: "Goodbye!",
Â Â Â Â "how are you": "I'm fine, thanks!"
Â Â };

Â Â function append(msg, cls, isHtml=false){
Â Â Â Â const d=document.createElement('div');
Â Â Â Â d.className='message '+cls;
Â Â Â Â isHtml ? d.innerHTML = msg : d.textContent = msg;
Â Â Â Â chat.appendChild(d);
Â Â Â Â chat.scrollTop = chat.scrollHeight;
Â Â }

Â Â function saveMem(){ localStorage.setItem('petgpt-memory', JSON.stringify(memory)); }

Â Â async function getReply(text){
Â Â Â Â const t=text.toLowerCase();
Â Â Â Â if(t.startsWith('remember:')){
Â Â Â Â Â Â const [k,v]=t.slice(9).split('=').map(s=>s.trim());
Â Â Â Â Â Â if(k&&v){ memory[k]=v; saveMem(); return `Okay, I'll remember ${k}`; }
Â Â Â Â Â Â return 'Use format: remember:key=value';
Â Â Â Â }
Â Â Â Â for(let k in memory) if(t.includes(k)) return `You told me ${k} = ${memory[k]}`;
Â Â Â Â for(let k in fallback) if(t.includes(k)) return fallback[k];
Â Â Â Â if(gptReady){
Â Â Â Â Â Â try {
Â Â Â Â Â Â Â Â const enc = await tokenizer.encode(text);
Â Â Â Â Â Â Â Â const out = await model.generate(enc.inputIds, {max_new_tokens:50, do_sample:true, temperature:0.7, top_p:0.9});
Â Â Â Â Â Â Â Â let dec = await tokenizer.decode(out[0]);
Â Â Â Â Â Â Â Â dec = dec.replace(text, '').trim();
Â Â Â Â Â Â Â Â return dec || "(no response)";
Â Â Â Â Â Â } catch(e){ console.error(e); }
Â Â Â Â }
Â Â Â Â return "I don't understand.";
Â Â }

Â Â async function send(){
Â Â Â Â const t=ui.value.trim();
Â Â Â Â if(!t) return;
Â Â Â Â append('You: '+t, 'user'); ui.value='...'; ui.disabled=true; btSend.disabled=true;
Â Â Â Â try{ const r=await getReply(t); append('PetGPT: '+r,'bot'); }
Â Â Â Â catch(e){ append('PetGPT: Error occurred','bot'); console.error(e);}
Â Â Â Â ui.disabled=false; btSend.disabled=false; ui.focus();
Â Â }

Â Â btSend.onclick = send;
Â Â ui.addEventListener('keydown', e=>{ if(e.key==='Enter'){ e.preventDefault(); send(); } });
Â Â btReset.onclick = ()=>{ if(confirm('Clear memory?')){ localStorage.clear(); memory={}; chat.innerHTML=''; append('Memory cleared.','bot'); }};
Â Â btVoice.onclick = ()=>{
Â Â Â Â if(!('SpeechRecognition' in window|| 'webkitSpeechRecognition' in window)) return alert('Voice not supported');
Â Â Â Â const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
Â Â Â Â const rec = new SR();
Â Â Â Â rec.lang='en-US'; rec.onresult = e=>{ ui.value=e.results[0][0].transcript; send(); };
Â Â Â Â rec.start();
Â Â };

Â Â fu.onchange = e=>{
Â Â Â Â const f=e.target.files[0];
Â Â Â Â if(!f)return;
Â Â Â Â const rd=new FileReader();
Â Â Â Â function toHex(buf){
Â Â Â Â Â Â const b=new Uint8Array(buf.slice(0,256));
Â Â Â Â Â Â return Array.from(b).map(x=>x.toString(16).padStart(2,'0')).join(' ');
Â Â Â Â }
Â Â Â Â rd.onload = ev=>{
Â Â Â Â Â Â const txt=ev.target.result;
Â Â Â Â Â Â const np=txt.replace(/[\x20-\x7E]/g,'').length;
Â Â Â Â Â Â if(np/txt.length>0.3){ readBin(); }
Â Â Â Â Â Â else {
Â Â Â Â Â Â Â Â append(`<b>File (text):</b> ${f.name}`,'bot',true);
Â Â Â Â Â Â Â Â append(txt.length>500?txt.substr(0,500)+'...':txt,'bot');
Â Â Â Â Â Â Â Â ui.value=txt.substr(0,500);
Â Â Â Â Â Â }
Â Â Â Â }
Â Â Â Â rd.onerror = ()=>{append('âš ï¸ Text read failed, reading binary...','bot'); readBin();}
Â Â Â Â const readBin=()=>{
Â Â Â Â Â Â const r2=new FileReader();
Â Â Â Â Â Â r2.onload = ev=>{ append(`<b>File (bin):</b> ${f.name}`,'bot',true); append(`<pre class="hex-preview">${toHex(ev.target.result)}</pre>`,'bot',true); };
Â Â Â Â Â Â r2.readAsArrayBuffer(f);
Â Â Â Â }
Â Â Â Â rd.readAsText(f); fu.value='';
Â Â };

Â Â append('Loading GPT-2 model...','bot');
Â Â try{
Â Â Â Â tokenizer = await window.transformers.AutoTokenizer.fromPretrained("gpt2");
Â Â Â Â model = await window.transformers.AutoModelForCausalLM.fromPretrained("gpt2");
Â Â Â Â gptReady = true;
Â Â Â Â append('GPT-2 loaded: Iâ€™m ready!','bot');
Â Â } catch(e){
Â Â Â Â append('GPT-2 failed. Using fallback.','bot');
Â Â Â Â console.error(e);
Â Â }
})();
</script>

</body>
</html>
